---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Card from "@/components/Card.astro";
import Pagination from "@/components/Pagination.astro";
import { getArticles } from "@/lib/strapi";
import { siteConfig } from "@/site.config";

const page = Number(Astro.url.searchParams.get("page") || "1");
const { data: articles, meta } = await getArticles(page, siteConfig.postsPerPage);
const totalPages = meta.pagination?.pageCount ?? 1;
---

<BaseLayout title="Blog â€” Automation Blog">
  <h1 class="text-3xl font-bold sm:text-4xl">Blog</h1>
  <p class="mt-2 text-text-muted">Articles about process automation, tools, and best practices.</p>

  {articles.length > 0 ? (
    <div class="mt-8 grid gap-4 sm:grid-cols-2">
      {articles.map((article: any) => (
        <Card
          title={article.title}
          href={`/blog/${article.slug}`}
          description={article.excerpt}
          date={article.publishedDate}
          coverImage={article.coverImage}
          tags={article.tags}
        />
      ))}
    </div>
  ) : (
    <p class="mt-8 text-text-muted">No articles yet. Check back soon!</p>
  )}

  <Pagination currentPage={page} totalPages={totalPages} baseUrl="/blog" />
</BaseLayout>
