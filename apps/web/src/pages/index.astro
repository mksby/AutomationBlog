---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Card from "@/components/Card.astro";
import { getArticles, getTutorials, getProjects } from "@/lib/strapi";
import { siteConfig } from "@/site.config";

const [articlesRes, tutorialsRes, projectsRes] = await Promise.all([
  getArticles(1, 3),
  getTutorials(1, 3),
  getProjects(1, 3),
]);

const articles = articlesRes.data;
const tutorials = tutorialsRes.data;
const projects = projectsRes.data;
---

<BaseLayout title={siteConfig.title}>
  <section class="py-8">
    <h1 class="text-4xl font-bold sm:text-5xl">{siteConfig.title}</h1>
    <p class="mt-3 text-lg text-text-muted">{siteConfig.description}</p>
  </section>

  {articles.length > 0 && (
    <section class="py-8">
      <div class="mb-6 flex items-center justify-between">
        <h2 class="text-2xl font-bold">Latest Articles</h2>
        <a href="/blog" class="text-sm font-medium text-link hover:text-accent transition-colors">
          View all &rarr;
        </a>
      </div>
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {articles.map((article: any) => (
          <Card
            title={article.title}
            href={`/blog/${article.slug}`}
            description={article.excerpt}
            date={article.publishedDate}
            coverImage={article.coverImage}
            tags={article.tags}
          />
        ))}
      </div>
    </section>
  )}

  {tutorials.length > 0 && (
    <section class="py-8">
      <div class="mb-6 flex items-center justify-between">
        <h2 class="text-2xl font-bold">Latest Tutorials</h2>
        <a href="/tutorials" class="text-sm font-medium text-link hover:text-accent transition-colors">
          View all &rarr;
        </a>
      </div>
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {tutorials.map((tutorial: any) => (
          <Card
            title={tutorial.title}
            href={`/tutorials/${tutorial.slug}`}
            description={tutorial.excerpt}
            coverImage={tutorial.coverImage}
            tags={tutorial.tags}
          />
        ))}
      </div>
    </section>
  )}

  {projects.length > 0 && (
    <section class="py-8">
      <div class="mb-6 flex items-center justify-between">
        <h2 class="text-2xl font-bold">Projects</h2>
        <a href="/projects" class="text-sm font-medium text-link hover:text-accent transition-colors">
          View all &rarr;
        </a>
      </div>
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {projects.map((project: any) => (
          <Card
            title={project.title}
            href={`/projects/${project.slug}`}
            description={project.description}
            coverImage={project.coverImage}
            tags={project.tags}
          />
        ))}
      </div>
    </section>
  )}
</BaseLayout>
