---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Card from "@/components/Card.astro";
import DifficultyBadge from "@/components/DifficultyBadge.astro";
import Pagination from "@/components/Pagination.astro";
import { getTutorials } from "@/lib/strapi";
import { siteConfig } from "@/site.config";

const page = Number(Astro.url.searchParams.get("page") || "1");
const { data: tutorials, meta } = await getTutorials(page, siteConfig.postsPerPage);
const totalPages = meta.pagination?.pageCount ?? 1;
---

<BaseLayout title="Tutorials â€” Automation Blog">
  <h1 class="text-3xl font-bold sm:text-4xl">Tutorials</h1>
  <p class="mt-2 text-text-muted">Step-by-step guides from beginner to advanced.</p>

  {tutorials.length > 0 ? (
    <div class="mt-8 grid gap-4 sm:grid-cols-2">
      {tutorials.map((tutorial: any) => (
        <Card
          title={tutorial.title}
          href={`/tutorials/${tutorial.slug}`}
          description={tutorial.excerpt}
          coverImage={tutorial.coverImage}
          tags={tutorial.tags}
        >
          <div class="mt-3 flex items-center gap-3">
            {tutorial.difficulty && <DifficultyBadge difficulty={tutorial.difficulty} />}
            {tutorial.estimatedTime && (
              <span class="text-xs text-text-muted">{tutorial.estimatedTime} min</span>
            )}
          </div>
        </Card>
      ))}
    </div>
  ) : (
    <p class="mt-8 text-text-muted">No tutorials yet. Check back soon!</p>
  )}

  <Pagination currentPage={page} totalPages={totalPages} baseUrl="/tutorials" />
</BaseLayout>
