---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getTutorials, getTutorialBySlug } from '../../lib/strapi';

export async function getStaticPaths() {
  const { data: tutorials } = await getTutorials(1, 100);
  return tutorials.map((t: any) => ({ params: { slug: t.slug } }));
}

const { slug } = Astro.params;
const { data: tutorials } = await getTutorialBySlug(slug!);
const tutorial = tutorials[0];

if (!tutorial) return Astro.redirect('/404');
---

<BaseLayout
  title={tutorial.seo?.metaTitle || tutorial.title}
  description={tutorial.seo?.metaDescription || tutorial.excerpt}
>
  <article>
    <h1>{tutorial.title}</h1>
    <div class="meta">
      {tutorial.difficulty && <span class={`badge ${tutorial.difficulty}`}>{tutorial.difficulty}</span>}
      {tutorial.estimatedTime && <span>{tutorial.estimatedTime} мин</span>}
    </div>
    {tutorial.prerequisites && (
      <div class="prerequisites">
        <h3>Требования</h3>
        <p>{tutorial.prerequisites}</p>
      </div>
    )}
    <div class="content">
      <p>Content rendering placeholder</p>
    </div>
  </article>
</BaseLayout>

<style>
  article { max-width: 800px; }
  .meta { display: flex; gap: 1rem; align-items: center; margin: 0.5rem 0 1.5rem; color: #666; }
  .badge { padding: 0.125rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
  .beginner { background: #dcfce7; color: #166534; }
  .intermediate { background: #fef3c7; color: #92400e; }
  .advanced { background: #fecaca; color: #991b1b; }
  .prerequisites { background: #f5f5f5; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; }
  .prerequisites h3 { margin-bottom: 0.5rem; font-size: 0.875rem; text-transform: uppercase; color: #666; }
</style>
