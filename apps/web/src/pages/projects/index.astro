---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Card from "@/components/Card.astro";
import StatusBadge from "@/components/StatusBadge.astro";
import Pagination from "@/components/Pagination.astro";
import { getProjects } from "@/lib/strapi";
import { siteConfig } from "@/site.config";

const page = Number(Astro.url.searchParams.get("page") || "1");
const { data: projects, meta } = await getProjects(page, siteConfig.postsPerPage);
const totalPages = meta.pagination?.pageCount ?? 1;
---

<BaseLayout title="Projects â€” Automation Blog">
  <h1 class="text-3xl font-bold sm:text-4xl">Projects</h1>
  <p class="mt-2 text-text-muted">Automation tools and open-source projects.</p>

  {projects.length > 0 ? (
    <div class="mt-8 grid gap-4 sm:grid-cols-2">
      {projects.map((project: any) => (
        <Card
          title={project.title}
          href={`/projects/${project.slug}`}
          description={project.description}
          coverImage={project.coverImage}
          tags={project.tags}
        >
          {project.status && (
            <div class="mt-3">
              <StatusBadge status={project.status} />
            </div>
          )}
        </Card>
      ))}
    </div>
  ) : (
    <p class="mt-8 text-text-muted">No projects yet. Check back soon!</p>
  )}

  <Pagination currentPage={page} totalPages={totalPages} baseUrl="/projects" />
</BaseLayout>
