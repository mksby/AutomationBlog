---
import BaseLayout from "@/layouts/BaseLayout.astro";
import StrapiBlocks from "@/components/StrapiBlocks.astro";
import { getPages, getPageBySlug, getStrapiMediaUrl } from "@/lib/strapi";

export async function getStaticPaths() {
  const { data: pages } = await getPages();
  return pages.map((page: any) => ({ params: { slug: page.slug } }));
}

const { slug } = Astro.params;
const { data: pages } = await getPageBySlug(slug!);
const page = pages[0];

if (!page) return Astro.redirect("/404");

const ogImage = page.seo?.ogImage
  ? getStrapiMediaUrl(page.seo.ogImage.url)
  : undefined;
---

<BaseLayout
  title={page.seo?.metaTitle || page.title}
  description={page.seo?.metaDescription || undefined}
  ogImage={ogImage}
>
  <article>
    <h1 class="text-3xl font-bold leading-tight sm:text-4xl">{page.title}</h1>

    {page.coverImage && (
      <img
        src={getStrapiMediaUrl(page.coverImage.url)}
        alt={page.coverImage.alternativeText || page.title}
        width={page.coverImage.width}
        height={page.coverImage.height}
        class="mt-6 aspect-video w-full rounded-xl object-cover"
      />
    )}

    <div class="mt-8">
      <StrapiBlocks content={page.content} />
    </div>
  </article>
</BaseLayout>
