---
import ThemeToggle from "./ThemeToggle.astro";
import Search from "./Search.astro";
import { siteConfig } from "@/site.config";

const navLinks = [
  { href: "/blog", label: "Blog" },
  { href: "/tutorials", label: "Tutorials" },
  { href: "/projects", label: "Projects" },
  { href: "/snippets", label: "Snippets" },
];

const currentPath = Astro.url.pathname;
---

<header class="border-b border-border py-4">
  <nav class="mx-auto flex max-w-3xl items-center justify-between px-4" aria-label="Main">
    <a href="/" class="text-lg font-bold tracking-tight text-text-body">
      {siteConfig.title}
    </a>
    <div class="flex items-center gap-1">
      <ul class="hidden items-center gap-1 sm:flex" role="list">
        {navLinks.map(({ href, label }) => (
          <li>
            <a
              href={href}
              class:list={[
                "rounded-md px-3 py-1.5 text-sm font-medium transition-colors",
                currentPath.startsWith(href)
                  ? "bg-surface text-accent"
                  : "text-text-muted hover:bg-surface hover:text-text-body",
              ]}
            >
              {label}
            </a>
          </li>
        ))}
      </ul>
      <Search />
      <ThemeToggle />
      <button
        id="mobile-menu-toggle"
        aria-label="Open menu"
        class="rounded-md p-2 transition-colors hover:bg-surface sm:hidden"
      >
        <svg class="size-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
  </nav>

  <div id="mobile-menu" class="hidden border-t border-border sm:hidden">
    <ul class="mx-auto max-w-3xl space-y-1 px-4 py-3" role="list">
      {navLinks.map(({ href, label }) => (
        <li>
          <a
            href={href}
            class:list={[
              "block rounded-md px-3 py-2 text-sm font-medium transition-colors",
              currentPath.startsWith(href)
                ? "bg-surface text-accent"
                : "text-text-muted hover:bg-surface hover:text-text-body",
            ]}
          >
            {label}
          </a>
        </li>
      ))}
    </ul>
  </div>
</header>

<script>
  function setupMobileMenu() {
    const toggle = document.getElementById("mobile-menu-toggle");
    const menu = document.getElementById("mobile-menu");

    toggle?.addEventListener("click", () => {
      menu?.classList.toggle("hidden");
    });
  }

  setupMobileMenu();
  document.addEventListener("astro:after-swap", setupMobileMenu);
</script>
