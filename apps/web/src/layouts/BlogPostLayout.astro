---
import BaseLayout from "./BaseLayout.astro";
import FormattedDate from "@/components/FormattedDate.astro";
import TagList from "@/components/TagList.astro";
import CategoryBadge from "@/components/CategoryBadge.astro";
import AuthorCard from "@/components/AuthorCard.astro";
import StrapiBlocks from "@/components/StrapiBlocks.astro";
import type { Article } from "@/lib/types";
import { getStrapiMediaUrl } from "@/lib/strapi";

interface Props {
  article: Article;
}

const { article } = Astro.props;
const ogImage = article.seo?.ogImage
  ? getStrapiMediaUrl(article.seo.ogImage.url)
  : undefined;
---

<BaseLayout
  title={article.seo?.metaTitle || article.title}
  description={article.seo?.metaDescription || article.excerpt || undefined}
  ogImage={ogImage}
>
  <article>
    <header class="mb-8">
      {article.categories.length > 0 && (
        <div class="mb-3 flex flex-wrap gap-2">
          {article.categories.map((cat) => (
            <CategoryBadge name={cat.name} slug={cat.slug} color={cat.color} />
          ))}
        </div>
      )}

      <h1 class="text-3xl font-bold leading-tight sm:text-4xl">
        {article.title}
      </h1>

      <div class="mt-3 flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-text-muted">
        {article.publishedDate && (
          <FormattedDate date={article.publishedDate} />
        )}
        {article.readingTime && (
          <span>{article.readingTime} min read</span>
        )}
      </div>
    </header>

    {article.coverImage && (
      <img
        src={getStrapiMediaUrl(article.coverImage.url)}
        alt={article.coverImage.alternativeText || article.title}
        width={article.coverImage.width}
        height={article.coverImage.height}
        class="mb-8 aspect-video w-full rounded-xl object-cover"
      />
    )}

    <StrapiBlocks content={article.content} />

    <footer class="mt-12 space-y-6 border-t border-border pt-8">
      {article.tags.length > 0 && <TagList tags={article.tags} />}
      {article.author && <AuthorCard author={article.author} />}
    </footer>
  </article>
</BaseLayout>
